{"version":3,"file":"index-es.js","sources":["../src/js/Subscriber.js","../src/js/EventControl.js"],"sourcesContent":["const mergeOption = function mergeOption(option, beforeOption) {\r\n  const mergedOption = {};\r\n  Object.keys(beforeOption).forEach((key) => {\r\n    if (Object.hasOwnProperty.call(option, key)) {\r\n      mergedOption[key] = option[key];\r\n    } else {\r\n      mergedOption[key] = beforeOption[key];\r\n    }\r\n  });\r\n  return mergedOption;\r\n};\r\n\r\nconst DEFAULT_OPTION = {\r\n  priority: 0,\r\n  once: false,\r\n  stopNextEvent: false,\r\n};\r\n\r\nclass Subscriber {\r\n  static defaultOption = DEFAULT_OPTION;\r\n\r\n  constructor(eventName, fn, option) {\r\n    this.eventName = eventName;\r\n    this.fn = fn;\r\n    this.option = mergeOption(option, Subscriber.defaultOption);\r\n  }\r\n\r\n  onMessage(args) {\r\n    let fnResult = this.fn(...args);\r\n\r\n    if (this.option.stopNextEvent) {\r\n      fnResult = true;\r\n    }\r\n\r\n    return {\r\n      once: this.option.once,\r\n      stopNextEvent: fnResult,\r\n    };\r\n  }\r\n\r\n  get priority() {\r\n    return this.option.priority;\r\n  }\r\n}\r\n\r\nexport default Subscriber;\r\n","import Subscriber from \"./Subscriber\";\r\n\r\nclass EventControl {\r\n  constructor() {\r\n    this.subscribersMap = new Map();\r\n  }\r\n\r\n  subscribe(eventName, fn, option) {\r\n    let subscribers = this.subscribersMap.get(eventName);\r\n\r\n    if (!subscribers) {\r\n      subscribers = [];\r\n      this.subscribersMap.set(eventName, subscribers);\r\n    }\r\n\r\n    const subscriber = new Subscriber(eventName, fn, option || {});\r\n    subscribers.push(subscriber);\r\n\r\n    if (\r\n      subscriber.priority\r\n      || subscribers[subscribers.length - 1].priority < 0\r\n    ) {\r\n      subscribers.sort((a, b) => b.priority - a.priority);\r\n    }\r\n\r\n    return subscriber;\r\n  }\r\n\r\n  unsubscribe(eventName, fn) {\r\n    const subscribers = this.subscribersMap.get(eventName);\r\n\r\n    const index = this.indexOfSubscribe(eventName, fn);\r\n    if (index !== -1) {\r\n      subscribers.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  indexOfSubscribe(eventName, fn) {\r\n    const subscribers = this.subscribersMap.get(eventName);\r\n    let index = -1;\r\n    if (subscribers && subscribers.length) {\r\n      index = subscribers.findIndex((i) => i.fn === fn);\r\n    }\r\n    return index;\r\n  }\r\n\r\n  notify(eventName, args) {\r\n    const subscribers = this.subscribersMap.get(eventName);\r\n    if (subscribers) {\r\n      let argsCopy = args;\r\n      if (!(argsCopy instanceof Array)) {\r\n        argsCopy = [argsCopy];\r\n      }\r\n      for (let i = 0; i < subscribers.length; i += 1) {\r\n        const subscriber = subscribers[i];\r\n        const { once, stopNextEvent } = subscriber.onMessage(argsCopy);\r\n\r\n        if (once) {\r\n          this.unsubscribe(eventName, subscriber.fn);\r\n          i -= 1;\r\n        }\r\n\r\n        if (stopNextEvent) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default EventControl;\r\n"],"names":["mergeOption","option","beforeOption","mergedOption","Object","keys","forEach","key","hasOwnProperty","call","DEFAULT_OPTION","priority","once","stopNextEvent","Subscriber","eventName","fn","_classCallCheck","defaultOption","_createClass","value","onMessage","args","fnResult","apply","_toConsumableArray","get","_defineProperty","EventControl","subscribersMap","Map","subscribe","subscribers","set","subscriber","push","length","sort","a","b","unsubscribe","index","indexOfSubscribe","splice","findIndex","i","notify","argsCopy","Array","_subscriber$onMessage"],"mappings":"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"}